## 게임 루프 패턴이란
게임 분야 외에서는 찾아보기 힘든 패턴이다.
하지만 유니티, 언리얼 엔진과 같은 게임 엔진에서는 이미 구현되어있을만큼 
거의 모든 게임이 사용하는 게임 루프 패턴으로, 아예 디자인 패턴으로 분류할 정도라고 한다.

게임 루프는 게임SW의 전체적인 흐름을 컨트롤하는 것을 의미한다.
그럼 루프라고 부르는 것이 아니라 게임 루프라는 용어를 사용할까?
게임 루프는 다른 프로그램과 다르게 게임 프로그램의 특징을 보여주는 프로그래밍 패턴이기 때문이다.

### 구조와 장점
대부분의 다른 SW와 달리 게임은 유저의 입력이 없어도 계속 돌아간다.

예를 들면, 
몬스터가 나오는 필드에 가만히 있으면 몬스터가 계속 때려서 언젠가 죽는다.

사용자의 입력 -> 게임 상태의 업데이트 -> 렌더링

이런 구조의 장점은, 
예전 프로그래밍 방식인 배치 프로그래밍과 달리,
그리고 사용자 입력을 처리하기만 마냥 기다리는 방식과 달리,
항상 루프가 돌아가면서 입력을 수시로 받으며 업데이트도 수시로 진행된다는 점이라는 것이다.

이렇게 루프에서 사용자 입력을 처리하지만 마냥 기다리고 있지 않는다는, **비동기 유저 입력**이라는 점이 게임 루프의 첫 번째 핵심이다.

---

## 프레임
게임을 운영하는데 필수적인 구조가 있다.
while(true)
{
	Update();
	Render();
}

갱신과 출력으로 이루어진 기본적인 게임 루프이고, 여기에 이것저것 추가하거나 변형할 수 있다.

Update()와 Render()를 1번 통과하면 게임 루프를 1번 통과했다고 표현하고, 그 단위를 프레임이라 한다. (프레임: "한 장면"을 의미한다)
게임루프를 1번 통과하면 1프레임, 2번 통과하면 2프레임인 식이다.

여기서 우리가 아는 프레임률, FPS(Frames Per Second) 개념도 언급된다.
Frame이란 Update와 Render가 1초에 몇 번 호출되었는지를 표현하는 수치이다.

### 프레임 레이트
여기서 프레임 레이트의 값을 결정하는 것도 중요하다.

한 프레임 안에서 얼마나 많은 작업을 수행하는가? 물리 계산이 복잡하고 오브젝트가 많을수록 CPU, GPU가 작업할 것들이 많아진다.
코드가 실행되는 플랫폼의 속도는? 하드웨어 속도가 빠르다면 같은 시간에 더 많은 작업이 가능하다.
이외에도 프레임 레이트를 결정하는 요인은 너무 많다. 그래서 프레임을 고정으로 사용하는 경우가 많다. (30FPS 또는 60FPS) 왜냐하면 모든 하드웨어가 똑같은 속도를 보장하지 않으므로 게임 루프에서는 일정한 속도에서 실행될 수 있도록 보장해야 하기 때문이다.

고정 프레임을 설정하더라도 게임이 잘 작동되도록 하려면, 프레임에 따라 실제 시간을 따라가도록 해야 한다. 즉, 프레임 이후로 실제 시간이 얼마나 지났는지에 따라 시간 간격을 조절해야 한다. 그러나 이러한 방식은 완벽하지 않다. 보통 게임에서는 부동 소수점(float)을 쓰기 때문에 반올림 오차가 생기기 마련이다. 컴퓨터 속도에 따라 반올림 오차가 커지면 오브젝트의 위치가 컴퓨터마다 다르게 보일 것이다. 이외에도 화면에 비추는 렌더링 빈도 동기화, 멀티 스레딩 등 엄청난 최적화를 거듭해서 게임 루프를 완성해야 한다.

그래서 대부분은 직접 구현하지 않고 이미 구현된 엔진을 쓴다.
(유니티의 Update, 언리얼의 Tick)

---

## 게임 루프의 종류
게임 루프에서는 비동기 유저 입력과 시간 따라잡기라는 핵심 요소 2개로 이뤄져있다.

- 고정 시간 스텝 게임 루프(Fixed Time Step Game Loop)
일정한 시간 간격으로 상태를 업데이트하고 렌더링한다.
예를 들어, 매 16ms마다 업데이트와 렌더링을 수행하면 초당 60프레임(FPS)으로 실행된다.
시간 관리가 간단하지만, 성능이 떨어지면(하드웨어와 게임 복잡도에 따라) 프레임이 누락될 수 있다.

- 가변 시간 스텝 게임 루프(Variable Time Step Game Loop)
각 루프에서 경과된 시간(DeltaTime)을 측정하고, 이를 기반으로 상태를 업데이트한다.
프레임마다 경과 시간이 다를 수 있어 물리 계산이나 애니메이션이 불규칙해질 수 있다.

- 하이브리드 게임 루프(Hybrid Game Loop)
고정 시간 스텝과 가변 시간 스텝을 결합하여 일정한 업데이트 주기를 유지하면서도 부드러운 렌더링을 제공한다.
즉, 업데이트는 고정 시간 간격, 렌더링을 가변 시간 간격으로.
고정 시간 간격으로 상태를 업데이트하고, 남은 시간을 보간(interpolation)하여 렌더링한다.
이 방법이 가장 적응력이 높아서 많이 쓰이나 구현 방법이 복잡해서 고사양, 저사양 유저를 모두 고려해야 한다고 한다.

---

## 참고
https://luv-n-interest.tistory.com/1104?category=996592